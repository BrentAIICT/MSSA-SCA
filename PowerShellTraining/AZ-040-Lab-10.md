---
lab:
    title: 'Lab: Managing Microsoft 365 with PowerShell'
    module: 'Module 10: Managing Microsoft 365 services with PowerShell'
---

<!--
    <details><summary>Click for hint</summary><Strong> 

    ``` 
    HINT
    ```
    </Strong></details> 
    <details><summary>Click to see the answer</summary><Strong> 
    
    ```
    ANSWER
    ```
    </Strong></details> 
-->

###### _


---
lab:
    title: 'Lab: Managing Microsoft 365 with PowerShell'
    type: 'Answer Key'
    module: 'Module 10: Managing Microsoft 365 services with PowerShell'
---

# Lab: Managing Microsoft 365 with PowerShell

## Exercise 1: Managing users and groups in Azure AD

### Task 1: Connect to Azure AD

1. On **LON-CL1**, select **Start**, and then enter **ISE**.
1. In the results list, right-click **PowerShell ISE** and then select **Run as administrator**.
1. To install the **AzureAD** module from PowerShell Gallery, type the following command, and then hit Enter:
   
    <details><summary>Click for hint</summary><Strong> 

    ``` 
    Get-Command *install*
    ```
    </Strong></details> 
    <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Install-Module AzureAD -Verbose -Force
   ```
    </Strong></details> 
   

1. Click "Yes" on the "NuGet Provider is required to continue" dialog box
2. Import the AzureAD module into PowerShell ISE
3. Find and execute a PowerShell cmdlet that will connect to AzureAD and sign in

    <details><summary>Click for hint</summary><Strong> 

    ``` 
    Get-Command Connect*
    ```
    </Strong></details> 
    <details><summary>Click to see the answer</summary><Strong> 
    
    ```powershell
    Connect-AzureAD
    ```
    </Strong></details> 


1. In the **Sign in to your account** window, enter your username that is included in the Resources tab of the lab instructions, and then select **Next**.
1. At the **Enter password** prompt, enter the password provided in the Resource tab, and then select **Sign in**.
1. To review a list of users in Azure AD, enter the following command, and then select Enter:

    <details><summary>Click for hint</summary><Strong> 

    ``` 
    Get-Command Get*AzureAD*
    ```
    </Strong></details> 
    <details><summary>Click to see the answer</summary><Strong> 
    
    ```powershell
    Get-AzureADUser
    ```
    </Strong></details>


### Task 2: Create a new administrative user

1. To create a **PasswordProfile** object, in the **Windows PowerShell** console:

    <details><summary>Click for hint</summary><Strong> 
    
    ``` 
    Get-Help New-AzureADUser -ShowWindow
    # In the help document look for PasswordProfile
    ```
    </Strong></details> 
    <details><summary>Click to see the answer</summary><Strong> 
    
    ```powershell
    $PasswordProfile = New-Object -TypeName Microsoft.Open.AzureAD.Model.PasswordProfile
    ```
    </Strong></details>


1. Think of a password that you want to use for a new user and make a note of it so that you don't forget. In the next step, replace `<password>` with the password you thought of.
1. To set the password property of the password profile object, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $PasswordProfile.Password = "<password>"
   ```
   </Strong></details>


1. To create a new Azure AD user, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $AzureADDomain = Get-AzureADDomain
   New-AzureADUser -DisplayName "Noreen Riggs" -UserPrincipalName Noreen@$($AzureADDomain.Name) -AccountEnabled $true -PasswordProfile $PasswordProfile -MailNickName Noreen
   ```
   </Strong></details>


1. To place the new user in a variable, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $user = Get-AzureADUser -ObjectID Noreen@$($AzureADDomain.Name)
   ```
   </Strong></details>    


1. To place the Global Administrator role in a variable, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $role = Get-AzureADDirectoryRole | Where {$_.displayName -eq 'Global Administrator'}
   ```
   </Strong></details>   


1. To assign Noreen to the global administrator role, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Add-AzureADDirectoryRoleMember -ObjectId $role.ObjectId -RefObjectId $user.ObjectID
   ```
   </Strong></details> 


1. To verify that Noreen is added to the global administrator role, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Get-AzureADDirectoryRoleMember -ObjectId $role.ObjectId
   ```
   </Strong></details> 


### Task 3: Create and license a new user

1. To create a new Azure AD user, in the **Windows PowerShell** console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   New-AzureADUser -DisplayName "Allan Yoo" -UserPrincipalName Allan@$($AzureADDomain.Name) -AccountEnabled $true -PasswordProfile $PasswordProfile -MailNickName Allan
   ```
   </Strong></details> 


1. To set the location for the user, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Set-AzureADUser -ObjectId Allan@$($AzureADDomain.Name) -UsageLocation US
   ```
   </Strong></details> 


1. To review the available licenses in the tenant, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Get-AzureADSubscribedSku | Format-List
   ```
   </Strong></details> 


1. To place the SKU ID for the desired license in a variable, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $SkuId = (Get-AzureADSubscribedSku | Where SkuPartNumber -eq "ENTERPRISEPREMIUM").SkuID
   ```
   </Strong></details> 


1. To create an **AssignedLicense** object, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $License = New-Object -TypeName Microsoft.Open.AzureAD.Model.AssignedLicense
   ```
   </Strong></details> 


1. To add the SKU ID to the license object, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $License.SkuId = $SkuId
   ```
   </Strong></details> 


1. To create an **AssignedLicenses** object, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $LicensesToAssign = New-Object -TypeName Microsoft.Open.AzureAD.Model.AssignedLicenses
   ```
   </Strong></details> 


1. To add the **AssignedLicense** object to the **AddLicenses** property, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $LicensesToAssign.AddLicenses = $License
   ```
   </Strong></details> 


1. To configure Allan with the **AssignedLicenses** object, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Set-AzureADUserLicense -ObjectId Allan@$($AzureADDomain.Name) -AssignedLicenses $LicensesToAssign
   ```
   </Strong></details> 


### Task 4: Create and populate a group

1. To review the existing groups, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Get-AzureADGroup
   ```
   </Strong></details> 


1. To create a new security group, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   New-AzureADGroup -DisplayName "Sales Security Group" -SecurityEnabled $true -MailEnabled $false -MailNickName "SalesSecurityGroup"
   ```
   </Strong></details> 


1. To put the Sales Security Group in a variable, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $group = Get-AzureAdGroup -SearchString "Sales Security"
   ```
   </Strong></details> 


1. To put Allan Yoo in a variable, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $user = Get-AzureADUser -ObjectId Allan@$($AzureADDomain.Name)
   ```
   </Strong></details> 


1. To add Allan Yoo as a member of Sales Security Group, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Add-AzureADGroupMember -ObjectId $group.ObjectId -RefObjectId $user.ObjectId
   ```
   </Strong></details> 


1. To verify Allan Yoo is a member of Sales Security Group,  enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Get-AzureADGroupMember -ObjectId $group.ObjectId
   ```
   </Strong></details> 


## Exercise 2: Managing Exchange Online

### Task 1: Connect to Exchange Online

1. On **LON-CL1**, select **Start**, and then enter **powersh**.
1. In the results list, right-click **Windows PowerShell** or activate its context menu, and then select **Run as administrator**.
1. To install the **ExchangeOnlineManagement** module, in the **Administrator: Windows PowerShell** console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Install-Module ExchangeOnlineManagement
   ```
   </Strong></details> 

1. Import the **ExchangeOnlineManagement** module

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Import-Module ExchangeOnlineManagement
   ```
   </Strong></details>     
    
1. To connect to Exchange Online, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Connect-ExchangeOnline
   ```
   </Strong></details> 


1. In the **Sign in to your account** window, enter your username, and then select **Next**.
1. At the **Enter password** prompt, enter your password, and then select **Sign in**.
1. To review a list of mailboxes in Exchange Online, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Get-EXOMailbox
   ```
   </Strong></details> 


### Task 2: Create a room mailbox

1. To create a new room mailbox, in the **Windows PowerShell** console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   New-Mailbox -Room -Name BoardRoom
   ```
   </Strong></details> 


1. To configure the new room to accept meeting requests, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Set-CalendarProcessing BoardRoom -AutomateProcessing AutoAccept
   ```
   </Strong></details> 


### Task 3: Verify room resource booking

1. On **LON-CL1**, on the taskbar, select **Microsoft Edge**.
1. In Microsoft Edge, in the address bar, enter **https://outlook.office.com**, and then select Enter.
1. Sign in as Allan Woo and change your password as instructed. Be sure to note the password so that you can remember it for later exercises.
1. When prompted to stay signed in, select **No**.
1. From the menu bar, select **Calendar**, and then select **New event**.
1. In the **Add a title** box, enter **Staff Meeting**.
1. In the **Invite attendees** box, enter **BoardRoom**, select **BoardRoom**, select the first available time, and then select **Send**.
1. From the menu, select **Mail**.
1. Verify that Allan has received a response from **BoardRoom** that the meeting request was accepted.
1. Close Microsoft Edge.

## Exercise 3: Managing SharePoint Online

### Task 1: Connect to SharePoint Online

1. Close the Windows PowerShell console.

1. Select **Start**, and then enter **powersh**.

1. In the results list, right-click **Windows PowerShell** or activate its context menu, and then select **Run as administrator**.

1. To install the SharePoint Online Management Shell, in the **Windows PowerShell** console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Install-Module -Name Microsoft.Online.SharePoint.PowerShell
   ```
   </Strong></details> 


1. When prompted to trust the repository, enter **A**, and then select Enter.

1. To connect to SharePoint Online, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Connect-SPOService -Url https://$($AzureADDomain.Name)
   ```
   </Strong></details> 


1. Sign in as Noreen Riggs and change your password as instructed. Be sure to note the password so that you can remember it for later exercises.

1. To review the existing sites, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Get-SPOSite
   ```
   </Strong></details> 


### Task 2: Create a new site

1. To review the available templates, in the **Windows PowerShell** console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Get-SPOWebTemplate
   ```
   </Strong></details> 


1. To create a new site, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   New-SPOSite -Url https://$($AzureADDomain.Name)/sites/Sales -Owner noreen@yourdomain.onmicrosoft.com -StorageQuota 256 -Template EHS#1
   ```
   </Strong></details> 


   > **Note:** It might take a few minutes for this command to complete processing.

1. To verify the status of the SharePoint site, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Get-SPOSite | FL Url,Status
   ```
   </Strong></details> 


   > **Note:** Creating the site can take 10 minutes or longer. Don't wait for site creation to complete.

1. To disconnect from SharePoint Online, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Disconnect-SPOService
   ```
   </Strong></details> 


## Exercise 4: Managing Microsoft Teams

### Task 1: Connect to Microsoft Teams

1. To install the SharePoint Online Management Shell, in the **Windows PowerShell** console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Install-Module MicrosoftTeams
   ```
   </Strong></details> 


1. When prompted to trust the repository, enter **A**, and then select Enter.
1. To connect to Microsoft Teams, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Connect-MicrosoftTeams
   ```
   </Strong></details> 


1. Sign in as your admin user. Notice that you can't use Noreen for this activity, because you need a Microsoft Teams license to create teams.
1. To verify that there are no existing teams, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Get-Team
   ```
   </Strong></details> 


### Task 2: Create a new team

1. To create a Sales team, in the **Windows PowerShell** console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   New-Team -DisplayName "Sales Team" -MailNickName "SalesTeam"
   ```
   </Strong></details> 


1. To place the team information in a variable, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $team = Get-Team -DisplayName "Sales Team"
   ```
   </Strong></details> 


1. To review the information about your team, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   $team | Format-List
   ```
   </Strong></details> 


1. Review the information about the Sales Team. Notice that **GroupId** is a unique identifier.
1. To add a user to the team, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Add-TeamUser -GroupId $team.GroupId -User Allan@$($AzureADDomain.Name) -Role Member
   ```
   </Strong></details> 


1. To review the team users, in the console, enter the following command, and then select Enter:

   <details><summary>Click to see the answer</summary><Strong> 
    
   ```powershell
   Get-TeamUser -GroupId $team.GroupId
   ```
   </Strong></details> 


   > **Note:** Notice that the user that created the team is an owner.

## Task 3: Verify access to the team

1. On **LON-CL1**, on the taskbar, select **Microsoft Edge**.
1. In Microsoft Edge, in the address bar, enter **https://teams.microsoft.com**, and then select Enter.
1. Sign in as Allan Yoo.
1. When prompted to stay signed in, select **No**.
1. Close the **Bring your team together** window, and then verify that **Sales Team** is listed.
1. Select **New conversation**, enter **Prices are increasing 10% at month end**, and then select Enter.
1. Close Microsoft Edge.


[Go to next lab](AZ-040-Lab-11.md#_)
